#
# Copyright (c) 2024 Nordic Semiconductor ASA
#
# SPDX-License-Identifier: LicenseRef-Nordic-5-Clause
#

target_sources_ifdef(CONFIG_APP_ENVIRONMENTAL app PRIVATE
	${CMAKE_CURRENT_SOURCE_DIR}/environmental.c
)

# generate encoder code using zcbor
set(zcbor_command
	zcbor code # Invoke code generation
	--cddl ${ZEPHYR_BASE}/subsys/net/lib/lwm2m/lwm2m_senml_cbor.cddl
	--cddl ${CMAKE_CURRENT_SOURCE_DIR}/env_object.cddl
	--encode # Generate encoding functions
	--short-names # Attempt to make generated symbol names shorter (at the risk of collision)
	-t env-object # Create a public API for decoding/encoding the "env-object" type from the cddl file
	--output-cmake env_object.cmake # The generated cmake file will be placed here
)
execute_process(COMMAND ${zcbor_command}
				WORKING_DIRECTORY ${CMAKE_CURRENT_BINARY_DIR}
				COMMAND_ERROR_IS_FATAL ANY)

# Include the cmake file generated by zcbor. It adds the
# generated code and the necessary zcbor C code files.
include(${CMAKE_CURRENT_BINARY_DIR}/env_object.cmake)

zephyr_link_libraries(env_object)
target_link_libraries(env_object PRIVATE zephyr_interface)
